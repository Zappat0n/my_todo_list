(()=>{"use strict";const e=[{field:"title",text:"Title: ",type:"text",required:"true"},{field:"description",text:"Description: ",type:"text",required:"true"},{field:"date",text:"Due date: ",type:"date",required:"true"},{field:"priority",text:"Priority: ",type:"number",required:"true"}],t=(()=>{const e=()=>{const e=localStorage.getItem("projects");try{return e?JSON.parse(e):[]}catch(e){return[]}},t=e();return{currentProject:void 0,load:e,projects:t,save:()=>{localStorage.setItem("projects",JSON.stringify(t))}}})(),r=(o=null)=>{const n=(e,t,r,o)=>{const n=document.createElement(t);return null!=r&&(n.textContent=r),null!=o&&o.forEach((e=>n.classList.add(e))),e.appendChild(n),n},d=(o,d)=>{const c=t.currentProject.getIndex(o);if(-1!==c){t.currentProject.currentTodo=t.currentProject.todos[c];const o=document.querySelector(".todo_container");o.innerHTML="",n(o,"p",`Title:   ${t.currentProject.currentTodo.title}`),n(o,"p",`Description: ${t.currentProject.currentTodo.description}`),n(o,"p",`Date: ${t.currentProject.currentTodo.dueDate}`),n(o,"p",`Priority: ${t.currentProject.currentTodo.priority}`);const u=n(o,"button","Remove"),i=n(o,"button","Edit");u.addEventListener("click",(()=>{t.currentProject.removeTodo(c),document.querySelector(".todo_container").innerHTML=""})),i.addEventListener("click",(()=>{o.innerHTML="",r(d).createForm(o,"form_edit_todo","form",e,t.currentProject.editTodo,[t.currentProject.currentTodo.title,t.currentProject.currentTodo.description,t.currentProject.currentTodo.dueDate,t.currentProject.currentTodo.priority],c)}))}},c=e=>{const r=document.querySelector(".todos");r.innerHTML="";const o=n(r,"ul");null!=t.currentProject&&t.currentProject.todos.forEach((t=>{n(o,"li",t.title,["todo"]).addEventListener("click",(t=>{d(t.target.textContent,e)}))}))};return{addElement:n,createForm:(e,t,r,n,d,c,u)=>{const i=document.createElement("form");e.appendChild(i),i.setAttribute("id",t),i.classList.add(r);let l=0;return n.forEach((e=>{const t=null!=c?c[l]:null,r=((e,t,r,o,n)=>{const d=document.createElement("div");d.classList.add("form_field");const c=document.createElement("label");c.setAttribute("for",e),c.textContent=t;const u=document.createElement("input");return u.setAttribute("type",r),u.setAttribute("name",e),u.setAttribute("id",e),o&&u.setAttribute("required",!0),null!=n&&u.setAttribute("value",n),d.appendChild(c),d.appendChild(u),d})(e.field,e.text,e.type,e.required,t);i.appendChild(r),l+=1})),i.appendChild((()=>{const e=document.createElement("input");return e.setAttribute("type","submit"),e.classList.add("btn"),e})()),i.addEventListener("submit",(e=>{e.preventDefault(),d(e.target.elements,o,u),i.classList.add("d-none")})),i},displayError:(e,t)=>{e.innerHTML="",n(e,"p",t,["warning"]),setTimeout((()=>{e.innerHTML=""}),3e3)},showTodo:d,updateCurrentProject:e=>{document.querySelector(".current_project").textContent=e},updateProjects:e=>{const r=document.querySelector(".ul_projects");r.innerHTML="",t.projects.forEach((o=>{n(r,"li",o.name,["project"]).addEventListener("click",(r=>{t.currentProject=e.getProject(r.target.textContent),c(e),document.querySelector(".todo_container").innerHTML=""}))}))},updateTodos:c}},o=(e,t,r,o)=>({title:e,description:t,dueDate:r,priority:o}),n=(e,n)=>((e,n,d,c=[])=>{const u=()=>{e(),r().updateTodos(t.currentProject),document.querySelector(".todo_container").innerHTML=""},i=(e,t)=>{for(let r=0;r<c.length;r+=1)if(e===c[r].title&&t!==r)return r;return-1};return{name:n,currentTodo:{},description:d,editTodo:(e,t,n)=>{if(null!=e){const d=o(e.title.value,e.description.value,e.date.value,e.priority.value);-1===i(d.title,n)&&(c[n]=d,u(),r().showTodo(e.title.value,t))}},getIndex:i,todos:c,addTodo:e=>{if(null!=e){const t=o(e.title.value,e.description.value,e.date.value,e.priority.value);c.push(t),u()}},removeTodo:e=>{-1!==e&&(c.splice(e,1),u())}}})(e,n.name,n.description,n.todos),d=(()=>{const e=e=>{for(let r=0;r<t.projects.length;r+=1)if(e===t.projects[r].name)return r;return-1},o=()=>{const o=e(t.currentProject.name);-1===o?t.projects.push(t.currentProject):t.projects[o]=t.currentProject,t.save(),r().updateTodos(t.currentProject)},d=(e,d,c)=>{const u={name:e,description:d,todos:[]};return t.currentProject=n(o,u),t.projects.push(t.currentProject),t.save(),r().updateCurrentProject(e),r().updateProjects(c),t.currentProject};return{addProject:(t,o)=>{null!=t&&-1===e(t.name.value)?d(t.name.value,t.description.name,o):r().displayError(document.querySelector(".new_project_warning"),"That project name already exists")},addTodo:e=>{-1===t.currentProject.getIndex(e.title.value)?t.currentProject.addTodo(e,t.currentProject):r().displayError(document.querySelector(".new_todo_warning"),"That Todo name already exists")},createProject:d,getProject:c=>{t.currentProject={};const u=e(c);return t.currentProject=-1!==u?n(o,t.projects[u]):d("default",null),r().updateCurrentProject(c),t.currentProject},save:o}})(),c=document.querySelector("body");r().addElement(c,"h1","My Todo List");const u=r().addElement(c,"div",null,["container"]),i=r().addElement(u,"div",null,["left_side"]);r().addElement(i,"h2","Projects");let l=r().addElement(i,"div",null,["title_and_button"]);r().addElement(l,"h3",null,["current_project"]);let a=r().addElement(l,"button","+",["show_project_form_button"]);const s=r(d).createForm(i,"form_new_project","form",[{field:"name",text:"Name: ",type:"text",required:"true"},{field:"description",text:"Description: ",type:"text",required:"true"}],d.addProject);s.classList.add("d-none"),a.addEventListener("click",(()=>{s.classList.toggle("d-none")})),r().addElement(i,"div",null,["new_project_warning"]),r().addElement(i,"ul",null,["ul_projects"]),r().updateProjects(d);const p=r().addElement(u,"div",null,["center_side"]);r().addElement(p,"h2","Todos"),l=r().addElement(p,"div",null,["title_and_button"]),r().addElement(l,"h3","Create Todo"),a=r().addElement(l,"button","+",["show_project_form_button"]),d.getProject("default");const m=r().createForm(p,"form_new_todo","form",e,d.addTodo);m.classList.add("d-none"),a.addEventListener("click",(()=>{m.classList.toggle("d-none")})),r().addElement(p,"div",null,["new_todo_warning"]),r().addElement(p,"div",null,["todos"]),r().updateTodos(d.getProject("default"));const j=r().addElement(u,"div",null,["right_side"]);r().addElement(j,"h2","Current Todo"),r().addElement(j,"div",null,["todo_container"])})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teV90b2RvX2xpc3QvLi9zcmMvdmlld3MvZGVzaWduX2RhdGEuanMiLCJ3ZWJwYWNrOi8vbXlfdG9kb19saXN0Ly4vc3JjL2RiL3N0b3JhZ2UuanMiLCJ3ZWJwYWNrOi8vbXlfdG9kb19saXN0Ly4vc3JjL3ZpZXdzL3ZpZXdfZGVzaWduZXIuanMiLCJ3ZWJwYWNrOi8vbXlfdG9kb19saXN0Ly4vc3JjL21vZGVscy90b2RvLmpzIiwid2VicGFjazovL215X3RvZG9fbGlzdC8uL3NyYy9tb2RlbHMvcHJvamVjdC5qcyIsIndlYnBhY2s6Ly9teV90b2RvX2xpc3QvLi9zcmMvY29udHJvbGxlcnMvcHJvamVjdC5qcyIsIndlYnBhY2s6Ly9teV90b2RvX2xpc3QvLi9zcmMvaW5kZXguanMiXSwibmFtZXMiOlsiZmllbGRzRm9yTmV3VG9kb0Zvcm0iLCJmaWVsZCIsInRleHQiLCJ0eXBlIiwicmVxdWlyZWQiLCJzdG9yYWdlIiwibG9hZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJKU09OIiwicGFyc2UiLCJleCIsInByb2plY3RzIiwiY3VycmVudFByb2plY3QiLCJzYXZlIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsInN0b3JhZ2VNYW5hZ2VyIiwiZGVzaWduZXIiLCJjb250cm9sbGVyIiwiYWRkRWxlbWVudCIsImNvbnRhaW5lciIsIl90ZXh0Q29udGVudCIsImNsYXNzZXMiLCJlbGVtZW50IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwidGV4dENvbnRlbnQiLCJmb3JFYWNoIiwidmFsdWUiLCJjbGFzc0xpc3QiLCJhZGQiLCJhcHBlbmRDaGlsZCIsInNob3dUb2RvIiwidGl0bGUiLCJpbmRleCIsImdldEluZGV4IiwiY3VycmVudFRvZG8iLCJ0b2RvcyIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJkZXNjcmlwdGlvbiIsImR1ZURhdGUiLCJwcmlvcml0eSIsImJSZW1vdmUiLCJiRWRpdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVUb2RvIiwiY3JlYXRlRm9ybSIsImVkaXRUb2RvIiwidXBkYXRlVG9kb3MiLCJ1bFRvZG8iLCJlIiwidGFyZ2V0IiwiaWQiLCJjbGFzc05hbWUiLCJmaWVsZHMiLCJjYWxsYmFjayIsInZhbHVlcyIsImZvcm0iLCJzZXRBdHRyaWJ1dGUiLCJpIiwiZGl2IiwibGFiZWwiLCJpbnB1dCIsImFkZEZpZWxkIiwiYnV0dG9uIiwiYWRkQnV0dG9uIiwicHJldmVudERlZmF1bHQiLCJlbGVtZW50cyIsImRpc3BsYXlFcnJvciIsIm1lc3NhZ2UiLCJzZXRUaW1lb3V0IiwidXBkYXRlQ3VycmVudFByb2plY3QiLCJuYW1lIiwidXBkYXRlUHJvamVjdHMiLCJwcm9qZWN0IiwiZ2V0UHJvamVjdCIsInRvZG8iLCJwcm9qZWN0RmFjdG9yeSIsIm9iaiIsInNhdmVBbmRSZWZyZXNoIiwicmVtb3ZpbmdUaGlzIiwibGVuZ3RoIiwidCIsImRhdGUiLCJhZGRUb2RvIiwicHVzaCIsInNwbGljZSIsImNyZWF0ZVByb2plY3QiLCJfbmFtZSIsIl9kZXNjcmlwdGlvbiIsIm1hbmFnZXIiLCJhZGRQcm9qZWN0IiwicHJvamVjdENvbnRyb2xsZXIiLCJib2R5IiwibGVmdFNpZGUiLCJ0aXRsZUFuZEJ1dHRvbiIsImZvcm1Qcm9qZWN0IiwidG9nZ2xlIiwiY2VudGVyU2lkZSIsImZvcm1Ub2RvIiwicmlnaHRTaWRlIl0sIm1hcHBpbmdzIjoibUJBQUEsTUFBTUEsRUFBdUIsQ0FDM0IsQ0FDRUMsTUFBTyxRQUNQQyxLQUFNLFVBQ05DLEtBQU0sT0FDTkMsU0FBVSxRQUVaLENBQ0VILE1BQU8sY0FDUEMsS0FBTSxnQkFDTkMsS0FBTSxPQUNOQyxTQUFVLFFBRVosQ0FDRUgsTUFBTyxPQUNQQyxLQUFNLGFBQ05DLEtBQU0sT0FDTkMsU0FBVSxRQUVaLENBQ0VILE1BQU8sV0FDUEMsS0FBTSxhQUNOQyxLQUFNLFNBQ05DLFNBQVUsU0NBUkMsRUF2QmlCLE1BQ3JCLE1BQU1DLEVBQU8sS0FDWCxNQUFNRCxFQUFVRSxhQUFh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QUFVQyxJQUFJLFVBQzFCLEVBQU9lLGlCQUFpQixTQUFTLEtBQVFvRCxFQUFZcEUsVUFBVXFFLE9BQU8sYUFDdEVqRixJQUFXRSxXQUFXNEUsRUFBVSxNQUFPLEtBQU0sQ0FBQyx3QkFDOUM5RSxJQUFXRSxXQUFXNEUsRUFBVSxLQUFNLEtBQU0sQ0FBQyxnQkFDN0M5RSxJQUFXeUQsZUFBZXhELEdBRTFCLE1BQU1pRixFQUFhbEYsSUFBV0UsV0FBV0MsRUFBVyxNQUFPLEtBQU0sQ0FBQyxnQkFDbEVILElBQVdFLFdBQVdnRixFQUFZLEtBQU0sU0FDeENILEVBQWlCL0UsSUFBV0UsV0FBV2dGLEVBQVksTUFBTyxLQUFNLENBQUMscUJBQ2pFbEYsSUFBV0UsV0FBVzZFLEVBQWdCLEtBQU0sZUFDNUMsRUFBUy9FLElBQVdFLFdBQVc2RSxFQUFnQixTQUFVLElBQUssQ0FBQyw2QkFDL0Q5RSxFQUFXMEQsV0FBVyxXQUN0QixNQUFNd0IsRUFBV25GLElBQVc4QixXQUFXb0QsRUFBWSxnQkFBaUIsT0FBUXBHLEVBQXNCbUIsRUFBV21FLFNBQzdHZSxFQUFTdkUsVUFBVUMsSUFBSSxVQUN2QixFQUFPZSxpQkFBaUIsU0FBUyxLQUFRdUQsRUFBU3ZFLFVBQVVxRSxPQUFPLGFBQ25FakYsSUFBV0UsV0FBV2dGLEVBQVksTUFBTyxLQUFNLENBQUMscUJBQ2hEbEYsSUFBV0UsV0FBV2dGLEVBQVksTUFBTyxLQUFNLENBQUMsVUFDaERsRixJQUFXZ0MsWUFBWS9CLEVBQVcwRCxXQUFXLFlBRTdDLE1BQU15QixFQUFZcEYsSUFBV0UsV0FBV0MsRUFBVyxNQUFPLEtBQU0sQ0FBQyxlQUNqRUgsSUFBV0UsV0FBV2tGLEVBQVcsS0FBTSxnQkFDdkNwRixJQUFXRSxXQUFXa0YsRUFBVyxNQUFPLEtBQU0sQ0FBQyxvQiIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgZmllbGRzRm9yTmV3VG9kb0Zvcm0gPSBbXG4gIHtcbiAgICBmaWVsZDogJ3RpdGxlJyxcbiAgICB0ZXh0OiAnVGl0bGU6ICcsXG4gICAgdHlwZTogJ3RleHQnLFxuICAgIHJlcXVpcmVkOiAndHJ1ZScsXG4gIH0sXG4gIHtcbiAgICBmaWVsZDogJ2Rlc2NyaXB0aW9uJyxcbiAgICB0ZXh0OiAnRGVzY3JpcHRpb246ICcsXG4gICAgdHlwZTogJ3RleHQnLFxuICAgIHJlcXVpcmVkOiAndHJ1ZScsXG4gIH0sXG4gIHtcbiAgICBmaWVsZDogJ2RhdGUnLFxuICAgIHRleHQ6ICdEdWUgZGF0ZTogJyxcbiAgICB0eXBlOiAnZGF0ZScsXG4gICAgcmVxdWlyZWQ6ICd0cnVlJyxcbiAgfSxcbiAge1xuICAgIGZpZWxkOiAncHJpb3JpdHknLFxuICAgIHRleHQ6ICdQcmlvcml0eTogJyxcbiAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICByZXF1aXJlZDogJ3RydWUnLFxuICB9LFxuXTtcblxuY29uc3QgZmllbGRzRm9yTmV3UHJvamVjdEZvcm0gPSBbXG4gIHtcbiAgICBmaWVsZDogJ25hbWUnLFxuICAgIHRleHQ6ICdOYW1lOiAnLFxuICAgIHR5cGU6ICd0ZXh0JyxcbiAgICByZXF1aXJlZDogJ3RydWUnLFxuICB9LFxuICB7XG4gICAgZmllbGQ6ICdkZXNjcmlwdGlvbicsXG4gICAgdGV4dDogJ0Rlc2NyaXB0aW9uOiAnLFxuICAgIHR5cGU6ICd0ZXh0JyxcbiAgICByZXF1aXJlZDogJ3RydWUnLFxuICB9LFxuXTtcblxuXG5leHBvcnQgeyBmaWVsZHNGb3JOZXdQcm9qZWN0Rm9ybSwgZmllbGRzRm9yTmV3VG9kb0Zvcm0gfTtcbiIsImNvbnN0IHN0b3JhZ2VNYW5hZ2VyID0gKCkgPT4ge1xuICBjb25zdCBsb2FkID0gKCkgPT4ge1xuICAgIGNvbnN0IHN0b3JhZ2UgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJvamVjdHMnKTtcblxuICAgIHRyeSB7XG4gICAgICByZXR1cm4gc3RvcmFnZSA/IEpTT04ucGFyc2Uoc3RvcmFnZSkgOiBbXTtcbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBwcm9qZWN0cyA9IGxvYWQoKTtcbiAgbGV0IGN1cnJlbnRQcm9qZWN0O1xuXG4gIGNvbnN0IHNhdmUgPSAoKSA9PiB7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Byb2plY3RzJywgSlNPTi5zdHJpbmdpZnkocHJvamVjdHMpKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGN1cnJlbnRQcm9qZWN0LCBsb2FkLCBwcm9qZWN0cywgc2F2ZSxcbiAgfTtcbn07XG5cbmNvbnN0IHN0b3JhZ2UgPSBzdG9yYWdlTWFuYWdlcigpO1xuXG5leHBvcnQgeyBzdG9yYWdlIGFzIGRlZmF1bHQgfTtcbiIsImltcG9ydCB7IGZpZWxkc0Zvck5ld1RvZG9Gb3JtIH0gZnJvbSAnLi9kZXNpZ25fZGF0YSc7XG5pbXBvcnQgc3RvcmFnZSBmcm9tICcuLi9kYi9zdG9yYWdlJztcblxuY29uc3QgZGVzaWduZXIgPSAoY29udHJvbGxlciA9IG51bGwpID0+IHtcbiAgY29uc3QgYWRkRWxlbWVudCA9IChjb250YWluZXIsIHR5cGUsIF90ZXh0Q29udGVudCwgY2xhc3NlcykgPT4ge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHR5cGUpO1xuICAgIGlmIChfdGV4dENvbnRlbnQgIT0gbnVsbCkge1xuICAgICAgZWxlbWVudC50ZXh0Q29udGVudCA9IF90ZXh0Q29udGVudDtcbiAgICB9XG5cbiAgICBpZiAoY2xhc3NlcyAhPSBudWxsKSB7XG4gICAgICBjbGFzc2VzLmZvckVhY2godmFsdWUgPT4gZWxlbWVudC5jbGFzc0xpc3QuYWRkKHZhbHVlKSk7XG4gICAgfVxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGVtZW50KTtcbiAgICByZXR1cm4gZWxlbWVudDtcbiAgfTtcblxuICBjb25zdCBjcmVhdGVGb3JtID0gKGNvbnRhaW5lciwgaWQsIGNsYXNzTmFtZSwgZmllbGRzLCBjYWxsYmFjaywgdmFsdWVzLCBpbmRleCkgPT4ge1xuICAgIGNvbnN0IGFkZEJ1dHRvbiA9ICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICBidXR0b24uc2V0QXR0cmlidXRlKCd0eXBlJywgJ3N1Ym1pdCcpO1xuICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ2J0bicpO1xuICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICB9O1xuXG4gICAgY29uc3QgYWRkRmllbGQgPSAoZmllbGQsIHRleHQsIHR5cGUsIHJlcXVpcmVkLCB2YWx1ZSkgPT4ge1xuICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBkaXYuY2xhc3NMaXN0LmFkZCgnZm9ybV9maWVsZCcpO1xuICAgICAgY29uc3QgbGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgICAgbGFiZWwuc2V0QXR0cmlidXRlKCdmb3InLCBmaWVsZCk7XG4gICAgICBsYWJlbC50ZXh0Q29udGVudCA9IHRleHQ7XG4gICAgICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCB0eXBlKTtcbiAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSgnbmFtZScsIGZpZWxkKTtcbiAgICAgIGlucHV0LnNldEF0dHJpYnV0ZSgnaWQnLCBmaWVsZCk7XG4gICAgICBpZiAocmVxdWlyZWQpIHtcbiAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCdyZXF1aXJlZCcsIHRydWUpO1xuICAgICAgfVxuICAgICAgaWYgKHZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKCd2YWx1ZScsIHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGRpdi5hcHBlbmRDaGlsZChsYWJlbCk7XG4gICAgICBkaXYuYXBwZW5kQ2hpbGQoaW5wdXQpO1xuICAgICAgcmV0dXJuIGRpdjtcbiAgICB9O1xuXG4gICAgY29uc3QgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTtcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZm9ybSk7XG4gICAgZm9ybS5zZXRBdHRyaWJ1dGUoJ2lkJywgaWQpO1xuICAgIGZvcm0uY2xhc3NMaXN0LmFkZChjbGFzc05hbWUpO1xuICAgIGxldCBpID0gMDtcbiAgICBmaWVsZHMuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzICE9IG51bGwgPyB2YWx1ZXNbaV0gOiBudWxsO1xuICAgICAgY29uc3QgZmllbGQgPSBhZGRGaWVsZChlbGVtZW50LmZpZWxkLCBlbGVtZW50LnRleHQsIGVsZW1lbnQudHlwZSwgZWxlbWVudC5yZXF1aXJlZCwgdmFsdWUpO1xuICAgICAgZm9ybS5hcHBlbmRDaGlsZChmaWVsZCk7XG4gICAgICBpICs9IDE7XG4gICAgfSk7XG4gICAgZm9ybS5hcHBlbmRDaGlsZChhZGRCdXR0b24oKSk7XG4gICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY2FsbGJhY2soZS50YXJnZXQuZWxlbWVudHMsIGNvbnRyb2xsZXIsIGluZGV4KTtcbiAgICAgIGZvcm0uY2xhc3NMaXN0LmFkZCgnZC1ub25lJyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIGZvcm07XG4gIH07XG5cbiAgY29uc3QgZGlzcGxheUVycm9yID0gKGNvbnRhaW5lciwgbWVzc2FnZSkgPT4ge1xuICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnJztcbiAgICBhZGRFbGVtZW50KGNvbnRhaW5lciwgJ3AnLCBtZXNzYWdlLCBbJ3dhcm5pbmcnXSk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG4gICAgfSwgMzAwMCk7XG4gIH07XG5cbiAgY29uc3Qgc2hvd1RvZG8gPSAodGl0bGUsIGNvbnRyb2xsZXIpID0+IHtcbiAgICBjb25zdCBpbmRleCA9IHN0b3JhZ2UuY3VycmVudFByb2plY3QuZ2V0SW5kZXgodGl0bGUpO1xuICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgIHN0b3JhZ2UuY3VycmVudFByb2plY3QuY3VycmVudFRvZG8gPSBzdG9yYWdlLmN1cnJlbnRQcm9qZWN0LnRvZG9zW2luZGV4XTtcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b2RvX2NvbnRhaW5lcicpO1xuICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgICAgYWRkRWxlbWVudChjb250YWluZXIsICdwJywgYFRpdGxlOiAgICR7c3RvcmFnZS5jdXJyZW50UHJvamVjdC5jdXJyZW50VG9kby50aXRsZX1gKTtcbiAgICAgIGFkZEVsZW1lbnQoY29udGFpbmVyLCAncCcsIGBEZXNjcmlwdGlvbjogJHtzdG9yYWdlLmN1cnJlbnRQcm9qZWN0LmN1cnJlbnRUb2RvLmRlc2NyaXB0aW9ufWApO1xuICAgICAgYWRkRWxlbWVudChjb250YWluZXIsICdwJywgYERhdGU6ICR7c3RvcmFnZS5jdXJyZW50UHJvamVjdC5jdXJyZW50VG9kby5kdWVEYXRlfWApO1xuICAgICAgYWRkRWxlbWVudChjb250YWluZXIsICdwJywgYFByaW9yaXR5OiAke3N0b3JhZ2UuY3VycmVudFByb2plY3QuY3VycmVudFRvZG8ucHJpb3JpdHl9YCk7XG4gICAgICBjb25zdCBiUmVtb3ZlID0gYWRkRWxlbWVudChjb250YWluZXIsICdidXR0b24nLCAnUmVtb3ZlJyk7XG4gICAgICBjb25zdCBiRWRpdCA9IGFkZEVsZW1lbnQoY29udGFpbmVyLCAnYnV0dG9uJywgJ0VkaXQnKTtcbiAgICAgIGJSZW1vdmUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIHN0b3JhZ2UuY3VycmVudFByb2plY3QucmVtb3ZlVG9kbyhpbmRleCk7XG4gICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b2RvX2NvbnRhaW5lcicpLmlubmVySFRNTCA9ICcnO1xuICAgICAgfSk7XG4gICAgICBiRWRpdC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgICAgICBkZXNpZ25lcihjb250cm9sbGVyKS5jcmVhdGVGb3JtKGNvbnRhaW5lciwgJ2Zvcm1fZWRpdF90b2RvJywgJ2Zvcm0nLCBmaWVsZHNGb3JOZXdUb2RvRm9ybSwgc3RvcmFnZS5jdXJyZW50UHJvamVjdC5lZGl0VG9kbywgW3N0b3JhZ2UuY3VycmVudFByb2plY3QuY3VycmVudFRvZG8udGl0bGUsIHN0b3JhZ2UuY3VycmVudFByb2plY3QuY3VycmVudFRvZG8uZGVzY3JpcHRpb24sIHN0b3JhZ2UuY3VycmVudFByb2plY3QuY3VycmVudFRvZG8uZHVlRGF0ZSwgc3RvcmFnZS5jdXJyZW50UHJvamVjdC5jdXJyZW50VG9kby5wcmlvcml0eV0sIGluZGV4KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCB1cGRhdGVUb2RvcyA9IChjb250cm9sbGVyKSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRvZG9zJyk7XG4gICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnO1xuICAgIGNvbnN0IHVsVG9kbyA9IGFkZEVsZW1lbnQoY29udGFpbmVyLCAndWwnKTtcbiAgICBpZiAoc3RvcmFnZS5jdXJyZW50UHJvamVjdCAhPSBudWxsKSB7XG4gICAgICBzdG9yYWdlLmN1cnJlbnRQcm9qZWN0LnRvZG9zLmZvckVhY2godmFsdWUgPT4ge1xuICAgICAgICBjb25zdCBlbGVtZW50ID0gYWRkRWxlbWVudCh1bFRvZG8sICdsaScsIHZhbHVlLnRpdGxlLCBbJ3RvZG8nXSk7XG4gICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcbiAgICAgICAgICBzaG93VG9kbyhlLnRhcmdldC50ZXh0Q29udGVudCwgY29udHJvbGxlcik7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHVwZGF0ZVByb2plY3RzID0gKGNvbnRyb2xsZXIpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudWxfcHJvamVjdHMnKTtcbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG4gICAgc3RvcmFnZS5wcm9qZWN0cy5mb3JFYWNoKHByb2plY3QgPT4ge1xuICAgICAgY29uc3QgbGkgPSBhZGRFbGVtZW50KGNvbnRhaW5lciwgJ2xpJywgcHJvamVjdC5uYW1lLCBbJ3Byb2plY3QnXSk7XG4gICAgICBsaS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIHN0b3JhZ2UuY3VycmVudFByb2plY3QgPSBjb250cm9sbGVyLmdldFByb2plY3QoZS50YXJnZXQudGV4dENvbnRlbnQpO1xuICAgICAgICB1cGRhdGVUb2Rvcyhjb250cm9sbGVyKTtcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRvZG9fY29udGFpbmVyJykuaW5uZXJIVE1MID0gJyc7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCB1cGRhdGVDdXJyZW50UHJvamVjdCA9IChuYW1lKSA9PiB7XG4gICAgY29uc3QgaDMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY3VycmVudF9wcm9qZWN0Jyk7XG4gICAgaDMudGV4dENvbnRlbnQgPSBuYW1lO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgYWRkRWxlbWVudCxcbiAgICBjcmVhdGVGb3JtLFxuICAgIGRpc3BsYXlFcnJvcixcbiAgICBzaG93VG9kbyxcbiAgICB1cGRhdGVDdXJyZW50UHJvamVjdCxcbiAgICB1cGRhdGVQcm9qZWN0cyxcbiAgICB1cGRhdGVUb2RvcyxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IGRlc2lnbmVyIGFzIGRlZmF1bHQgfTtcbiIsImNvbnN0IHRvZG8gPSAodGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBwcmlvcml0eSkgPT4gKHtcbiAgdGl0bGUsIGRlc2NyaXB0aW9uLCBkdWVEYXRlLCBwcmlvcml0eSxcbn0pO1xuXG5leHBvcnQgeyB0b2RvIGFzIGRlZmF1bHQgfTtcbiIsImltcG9ydCB0b2RvIGZyb20gJy4vdG9kbyc7XG5pbXBvcnQgZGVzaWduZXIgZnJvbSAnLi4vdmlld3Mvdmlld19kZXNpZ25lcic7XG5pbXBvcnQgc3RvcmFnZSBmcm9tICcuLi9kYi9zdG9yYWdlJztcblxuY29uc3QgcHJvamVjdCA9IChzYXZlLCBuYW1lLCBkZXNjcmlwdGlvbiwgdG9kb3MgPSBbXSkgPT4ge1xuICBjb25zdCBjdXJyZW50VG9kbyA9IHt9O1xuXG4gIGNvbnN0IHNhdmVBbmRSZWZyZXNoID0gKCkgPT4ge1xuICAgIHNhdmUoKTtcbiAgICBkZXNpZ25lcigpLnVwZGF0ZVRvZG9zKHN0b3JhZ2UuY3VycmVudFByb2plY3QpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50b2RvX2NvbnRhaW5lcicpLmlubmVySFRNTCA9ICcnO1xuICB9O1xuXG4gIGNvbnN0IGFkZFRvZG8gPSAoZWxlbWVudHMpID0+IHtcbiAgICBpZiAoZWxlbWVudHMgIT0gbnVsbCkge1xuICAgICAgY29uc3QgdCA9IHRvZG8oZWxlbWVudHMudGl0bGUudmFsdWUsIGVsZW1lbnRzLmRlc2NyaXB0aW9uLnZhbHVlLCBlbGVtZW50cy5kYXRlLnZhbHVlLFxuICAgICAgICBlbGVtZW50cy5wcmlvcml0eS52YWx1ZSk7XG4gICAgICB0b2Rvcy5wdXNoKHQpO1xuICAgICAgc2F2ZUFuZFJlZnJlc2goKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0SW5kZXggPSAodGl0bGUsIHJlbW92aW5nVGhpcykgPT4ge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0b2Rvcy5sZW5ndGg7IGluZGV4ICs9IDEpIHtcbiAgICAgIGlmICh0aXRsZSA9PT0gdG9kb3NbaW5kZXhdLnRpdGxlICYmIHJlbW92aW5nVGhpcyAhPT0gaW5kZXgpIHJldHVybiBpbmRleDtcbiAgICB9XG4gICAgcmV0dXJuIC0xO1xuICB9O1xuXG4gIGNvbnN0IGVkaXRUb2RvID0gKGVsZW1lbnRzLCBjb250cm9sbGVyLCBpbmRleCkgPT4ge1xuICAgIGlmIChlbGVtZW50cyAhPSBudWxsKSB7XG4gICAgICBjb25zdCB0ID0gdG9kbyhlbGVtZW50cy50aXRsZS52YWx1ZSwgZWxlbWVudHMuZGVzY3JpcHRpb24udmFsdWUsIGVsZW1lbnRzLmRhdGUudmFsdWUsXG4gICAgICAgIGVsZW1lbnRzLnByaW9yaXR5LnZhbHVlKTtcbiAgICAgIGlmIChnZXRJbmRleCh0LnRpdGxlLCBpbmRleCkgPT09IC0xKSB7XG4gICAgICAgIHRvZG9zW2luZGV4XSA9IHQ7XG4gICAgICAgIHNhdmVBbmRSZWZyZXNoKCk7XG4gICAgICAgIGRlc2lnbmVyKCkuc2hvd1RvZG8oZWxlbWVudHMudGl0bGUudmFsdWUsIGNvbnRyb2xsZXIpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCByZW1vdmVUb2RvID0gKGluZGV4KSA9PiB7XG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgdG9kb3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgIHNhdmVBbmRSZWZyZXNoKCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgbmFtZSwgY3VycmVudFRvZG8sIGRlc2NyaXB0aW9uLCBlZGl0VG9kbywgZ2V0SW5kZXgsIHRvZG9zLCBhZGRUb2RvLCByZW1vdmVUb2RvLFxuICB9O1xufTtcblxuY29uc3QgcHJvamVjdEZhY3RvcnkgPSAoc2F2ZSwgb2JqKSA9PiBwcm9qZWN0KHNhdmUsIG9iai5uYW1lLCBvYmouZGVzY3JpcHRpb24sIG9iai50b2Rvcyk7XG5cbmV4cG9ydCB7IHByb2plY3RGYWN0b3J5IGFzIGRlZmF1bHQgfTtcbiIsImltcG9ydCBwcm9qZWN0RmFjdG9yeSBmcm9tICcuLi9tb2RlbHMvcHJvamVjdCc7XG5pbXBvcnQgc3RvcmFnZSBmcm9tICcuLi9kYi9zdG9yYWdlJztcbmltcG9ydCBkZXNpZ25lciBmcm9tICcuLi92aWV3cy92aWV3X2Rlc2lnbmVyJztcblxuY29uc3QgcHJvamVjdENvbnRyb2xsZXIgPSAoKSA9PiB7XG4gIGNvbnN0IGFkZFRvZG8gPSAoZWxlbWVudHMpID0+IHtcbiAgICBpZiAoc3RvcmFnZS5jdXJyZW50UHJvamVjdC5nZXRJbmRleChlbGVtZW50cy50aXRsZS52YWx1ZSkgPT09IC0xKSB7XG4gICAgICBzdG9yYWdlLmN1cnJlbnRQcm9qZWN0LmFkZFRvZG8oZWxlbWVudHMsIHN0b3JhZ2UuY3VycmVudFByb2plY3QpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZXNpZ25lcigpLmRpc3BsYXlFcnJvcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3X3RvZG9fd2FybmluZycpLCAnVGhhdCBUb2RvIG5hbWUgYWxyZWFkeSBleGlzdHMnKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0SW5kZXggPSAobmFtZSkgPT4ge1xuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzdG9yYWdlLnByb2plY3RzLmxlbmd0aDsgaW5kZXggKz0gMSkge1xuICAgICAgaWYgKG5hbWUgPT09IHN0b3JhZ2UucHJvamVjdHNbaW5kZXhdLm5hbWUpIHJldHVybiBpbmRleDtcbiAgICB9XG4gICAgcmV0dXJuIC0xO1xuICB9O1xuXG4gIGNvbnN0IHNhdmUgPSAoKSA9PiB7XG4gICAgY29uc3QgaW5kZXggPSBnZXRJbmRleChzdG9yYWdlLmN1cnJlbnRQcm9qZWN0Lm5hbWUpO1xuICAgIGlmIChpbmRleCA9PT0gLTEpIHtcbiAgICAgIHN0b3JhZ2UucHJvamVjdHMucHVzaChzdG9yYWdlLmN1cnJlbnRQcm9qZWN0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RvcmFnZS5wcm9qZWN0c1tpbmRleF0gPSBzdG9yYWdlLmN1cnJlbnRQcm9qZWN0O1xuICAgIH1cbiAgICBzdG9yYWdlLnNhdmUoKTtcbiAgICBkZXNpZ25lcigpLnVwZGF0ZVRvZG9zKHN0b3JhZ2UuY3VycmVudFByb2plY3QpO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZVByb2plY3QgPSAoX25hbWUsIF9kZXNjcmlwdGlvbiwgbWFuYWdlcikgPT4ge1xuICAgIGNvbnN0IHRvZG9zID0gW107XG4gICAgY29uc3Qgb2JqID0geyBuYW1lOiBfbmFtZSwgZGVzY3JpcHRpb246IF9kZXNjcmlwdGlvbiwgdG9kb3MgfTtcbiAgICBzdG9yYWdlLmN1cnJlbnRQcm9qZWN0ID0gcHJvamVjdEZhY3Rvcnkoc2F2ZSwgb2JqKTtcbiAgICBzdG9yYWdlLnByb2plY3RzLnB1c2goc3RvcmFnZS5jdXJyZW50UHJvamVjdCk7XG4gICAgc3RvcmFnZS5zYXZlKCk7XG4gICAgZGVzaWduZXIoKS51cGRhdGVDdXJyZW50UHJvamVjdChfbmFtZSk7XG4gICAgZGVzaWduZXIoKS51cGRhdGVQcm9qZWN0cyhtYW5hZ2VyKTtcbiAgICByZXR1cm4gc3RvcmFnZS5jdXJyZW50UHJvamVjdDtcbiAgfTtcblxuICBjb25zdCBhZGRQcm9qZWN0ID0gKGVsZW1lbnRzLCBtYW5hZ2VyKSA9PiB7XG4gICAgaWYgKGVsZW1lbnRzICE9IG51bGwgJiYgZ2V0SW5kZXgoZWxlbWVudHMubmFtZS52YWx1ZSkgPT09IC0xKSB7XG4gICAgICBjcmVhdGVQcm9qZWN0KGVsZW1lbnRzLm5hbWUudmFsdWUsIGVsZW1lbnRzLmRlc2NyaXB0aW9uLm5hbWUsIG1hbmFnZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZXNpZ25lcigpLmRpc3BsYXlFcnJvcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubmV3X3Byb2plY3Rfd2FybmluZycpLCAnVGhhdCBwcm9qZWN0IG5hbWUgYWxyZWFkeSBleGlzdHMnKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0UHJvamVjdCA9IChuYW1lKSA9PiB7XG4gICAgc3RvcmFnZS5jdXJyZW50UHJvamVjdCA9IHt9O1xuICAgIGNvbnN0IGluZGV4ID0gZ2V0SW5kZXgobmFtZSk7XG4gICAgc3RvcmFnZS5jdXJyZW50UHJvamVjdCA9IGluZGV4ICE9PSAtMSA/IHByb2plY3RGYWN0b3J5KHNhdmUsIHN0b3JhZ2UucHJvamVjdHNbaW5kZXhdKSA6IGNyZWF0ZVByb2plY3QoJ2RlZmF1bHQnLCBudWxsKTtcbiAgICBkZXNpZ25lcigpLnVwZGF0ZUN1cnJlbnRQcm9qZWN0KG5hbWUpO1xuICAgIHJldHVybiBzdG9yYWdlLmN1cnJlbnRQcm9qZWN0O1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgYWRkUHJvamVjdCwgYWRkVG9kbywgY3JlYXRlUHJvamVjdCwgZ2V0UHJvamVjdCwgc2F2ZSxcbiAgfTtcbn07XG5cbmNvbnN0IGNvbnRyb2xsZXIgPSBwcm9qZWN0Q29udHJvbGxlcigpO1xuXG5leHBvcnQgeyBjb250cm9sbGVyIGFzIGRlZmF1bHQgfTtcbiIsImltcG9ydCAnLi9jc3Mvc3R5bGUuc2Nzcyc7XG5pbXBvcnQgZGVzaWduZXIgZnJvbSAnLi92aWV3cy92aWV3X2Rlc2lnbmVyJztcbmltcG9ydCB7IGZpZWxkc0Zvck5ld1Byb2plY3RGb3JtLCBmaWVsZHNGb3JOZXdUb2RvRm9ybSB9IGZyb20gJy4vdmlld3MvZGVzaWduX2RhdGEnO1xuaW1wb3J0IGNvbnRyb2xsZXIgZnJvbSAnLi9jb250cm9sbGVycy9wcm9qZWN0JztcblxuY29uc3QgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcbmRlc2lnbmVyKCkuYWRkRWxlbWVudChib2R5LCAnaDEnLCAnTXkgVG9kbyBMaXN0Jyk7XG5jb25zdCBjb250YWluZXIgPSBkZXNpZ25lcigpLmFkZEVsZW1lbnQoYm9keSwgJ2RpdicsIG51bGwsIFsnY29udGFpbmVyJ10pO1xuXG5jb25zdCBsZWZ0U2lkZSA9IGRlc2lnbmVyKCkuYWRkRWxlbWVudChjb250YWluZXIsICdkaXYnLCBudWxsLCBbJ2xlZnRfc2lkZSddKTtcbmRlc2lnbmVyKCkuYWRkRWxlbWVudChsZWZ0U2lkZSwgJ2gyJywgJ1Byb2plY3RzJyk7XG5sZXQgdGl0bGVBbmRCdXR0b24gPSBkZXNpZ25lcigpLmFkZEVsZW1lbnQobGVmdFNpZGUsICdkaXYnLCBudWxsLCBbJ3RpdGxlX2FuZF9idXR0b24nXSk7XG5kZXNpZ25lcigpLmFkZEVsZW1lbnQodGl0bGVBbmRCdXR0b24sICdoMycsIG51bGwsIFsnY3VycmVudF9wcm9qZWN0J10pO1xubGV0IGJ1dHRvbiA9IGRlc2lnbmVyKCkuYWRkRWxlbWVudCh0aXRsZUFuZEJ1dHRvbiwgJ2J1dHRvbicsICcrJywgWydzaG93X3Byb2plY3RfZm9ybV9idXR0b24nXSk7XG5jb25zdCBmb3JtUHJvamVjdCA9IGRlc2lnbmVyKGNvbnRyb2xsZXIpLmNyZWF0ZUZvcm0obGVmdFNpZGUsICdmb3JtX25ld19wcm9qZWN0JywgJ2Zvcm0nLCBmaWVsZHNGb3JOZXdQcm9qZWN0Rm9ybSwgY29udHJvbGxlci5hZGRQcm9qZWN0KTtcbmZvcm1Qcm9qZWN0LmNsYXNzTGlzdC5hZGQoJ2Qtbm9uZScpO1xuYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBmb3JtUHJvamVjdC5jbGFzc0xpc3QudG9nZ2xlKCdkLW5vbmUnKTsgfSk7XG5kZXNpZ25lcigpLmFkZEVsZW1lbnQobGVmdFNpZGUsICdkaXYnLCBudWxsLCBbJ25ld19wcm9qZWN0X3dhcm5pbmcnXSk7XG5kZXNpZ25lcigpLmFkZEVsZW1lbnQobGVmdFNpZGUsICd1bCcsIG51bGwsIFsndWxfcHJvamVjdHMnXSk7XG5kZXNpZ25lcigpLnVwZGF0ZVByb2plY3RzKGNvbnRyb2xsZXIpO1xuXG5jb25zdCBjZW50ZXJTaWRlID0gZGVzaWduZXIoKS5hZGRFbGVtZW50KGNvbnRhaW5lciwgJ2RpdicsIG51bGwsIFsnY2VudGVyX3NpZGUnXSk7XG5kZXNpZ25lcigpLmFkZEVsZW1lbnQoY2VudGVyU2lkZSwgJ2gyJywgJ1RvZG9zJyk7XG50aXRsZUFuZEJ1dHRvbiA9IGRlc2lnbmVyKCkuYWRkRWxlbWVudChjZW50ZXJTaWRlLCAnZGl2JywgbnVsbCwgWyd0aXRsZV9hbmRfYnV0dG9uJ10pO1xuZGVzaWduZXIoKS5hZGRFbGVtZW50KHRpdGxlQW5kQnV0dG9uLCAnaDMnLCAnQ3JlYXRlIFRvZG8nKTtcbmJ1dHRvbiA9IGRlc2lnbmVyKCkuYWRkRWxlbWVudCh0aXRsZUFuZEJ1dHRvbiwgJ2J1dHRvbicsICcrJywgWydzaG93X3Byb2plY3RfZm9ybV9idXR0b24nXSk7XG5jb250cm9sbGVyLmdldFByb2plY3QoJ2RlZmF1bHQnKTtcbmNvbnN0IGZvcm1Ub2RvID0gZGVzaWduZXIoKS5jcmVhdGVGb3JtKGNlbnRlclNpZGUsICdmb3JtX25ld190b2RvJywgJ2Zvcm0nLCBmaWVsZHNGb3JOZXdUb2RvRm9ybSwgY29udHJvbGxlci5hZGRUb2RvKTtcbmZvcm1Ub2RvLmNsYXNzTGlzdC5hZGQoJ2Qtbm9uZScpO1xuYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4geyBmb3JtVG9kby5jbGFzc0xpc3QudG9nZ2xlKCdkLW5vbmUnKTsgfSk7XG5kZXNpZ25lcigpLmFkZEVsZW1lbnQoY2VudGVyU2lkZSwgJ2RpdicsIG51bGwsIFsnbmV3X3RvZG9fd2FybmluZyddKTtcbmRlc2lnbmVyKCkuYWRkRWxlbWVudChjZW50ZXJTaWRlLCAnZGl2JywgbnVsbCwgWyd0b2RvcyddKTtcbmRlc2lnbmVyKCkudXBkYXRlVG9kb3MoY29udHJvbGxlci5nZXRQcm9qZWN0KCdkZWZhdWx0JykpO1xuXG5jb25zdCByaWdodFNpZGUgPSBkZXNpZ25lcigpLmFkZEVsZW1lbnQoY29udGFpbmVyLCAnZGl2JywgbnVsbCwgWydyaWdodF9zaWRlJ10pO1xuZGVzaWduZXIoKS5hZGRFbGVtZW50KHJpZ2h0U2lkZSwgJ2gyJywgJ0N1cnJlbnQgVG9kbycpO1xuZGVzaWduZXIoKS5hZGRFbGVtZW50KHJpZ2h0U2lkZSwgJ2RpdicsIG51bGwsIFsndG9kb19jb250YWluZXInXSk7XG4iXSwic291cmNlUm9vdCI6IiJ9